╔══════════════════════════════════════════════════════════════════════════════╗
║                    VIDEO INSIGHTS GENERATOR - DATABASE SCHEMA                ║
╚══════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────┐
│                           auth.users (Supabase)                              │
│  ─────────────────────────────────────────────────────────────────────────  │
│  │ id (UUID) ────────────────┐                                              │
│  │ email (TEXT)               │                                              │
│  │ created_at (TIMESTAMP)     │                                              │
│  └────────────────────────────┘                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    │ 1:N
                                    │
                    ┌───────────────┴───────────────┐
                    │                               │
                    ▼                               ▼
┌───────────────────────────────────┐  ┌───────────────────────────────────┐
│            videos                  │  │          questions                 │
│  ──────────────────────────────── │  │  ──────────────────────────────── │
│  │ id (UUID) ────────────────┐   │  │  │ id (UUID) ────────────────┐   │
│  │ user_id (UUID) ───────────┼───┼──┼──┼ user_id (UUID) ────────────┼───┼──┐
│  │ video_source (TEXT)       │   │  │  │ video_id (UUID) ───────────┼───┼──┼──┐
│  │ transcript (TEXT)         │   │  │  │ question (TEXT)            │   │  │  │
│  │ summary (TEXT)            │   │  │  │ answer (TEXT)               │   │  │  │
│  │ insights (TEXT)           │   │  │  │ video_source (TEXT)         │   │  │  │
│  │ action_items (TEXT)       │   │  │  │ created_at (TIMESTAMP)      │   │  │  │
│  │ created_at (TIMESTAMP)    │   │  │  └────────────────────────────┘   │  │  │
│  │ updated_at (TIMESTAMP)    │   │  │                                   │  │  │
│  └───────────────────────────┘   │  │                                   │  │  │
│            │                       │  │                                   │  │  │
│            │ 1:N (optional)       │  │                                   │  │  │
│            └───────────────────────┘  │                                   │  │  │
│                                       │                                   │  │  │
└───────────────────────────────────────┘                                   │  │  │
                                                                              │  │  │
                                                                              │  │  │
┌────────────────────────────────────────────────────────────────────────────┼──┼──┘
│                              RELATIONSHIPS                                  │  │
│  ─────────────────────────────────────────────────────────────────────────  │  │
│                                                                              │  │
│  1. auth.users ──< (1:N) ── videos                                         │  │
│     • One user can have many videos                                         │  │
│     • ON DELETE CASCADE                                                     │  │
│                                                                              │  │
│  2. auth.users ──< (1:N) ── questions                                       │  │
│     • One user can ask many questions                                       │  │
│     • ON DELETE CASCADE                                                     │  │
│                                                                              │  │
│  3. videos ──< (1:N, optional) ── questions                                │  │
│     • One video can have many questions                                     │  │
│     • Questions can exist without video_id (using video_source)             │  │
│     • ON DELETE CASCADE                                                     │  │
└──────────────────────────────────────────────────────────────────────────────┘  │
                                                                                   │
┌─────────────────────────────────────────────────────────────────────────────────┘
│                              INDEXES                                           │
│  ───────────────────────────────────────────────────────────────────────────  │
│                                                                                 │
│  videos:                                                                        │
│    • idx_videos_user_id (user_id)                                              │
│    • idx_videos_created_at (created_at DESC)                                   │
│                                                                                 │
│  questions:                                                                     │
│    • idx_questions_user_id (user_id)                                            │
│    • idx_questions_video_id (video_id)                                         │
│    • idx_questions_created_at (created_at DESC)                                │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                         ROW LEVEL SECURITY (RLS)                                │
│  ───────────────────────────────────────────────────────────────────────────  │
│                                                                                 │
│  ✅ RLS Enabled on both tables                                                 │
│                                                                                 │
│  Policies:                                                                      │
│    • Users can only SELECT their own records                                   │
│    • Users can only INSERT records with their own user_id                      │
│    • Users can only UPDATE their own records                                   │
│    • Users can only DELETE their own records                                   │
│                                                                                 │
│  All policies use: auth.uid() = user_id                                        │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                              TRIGGERS                                           │
│  ───────────────────────────────────────────────────────────────────────────  │
│                                                                                 │
│  update_videos_updated_at                                                       │
│    • Automatically updates updated_at timestamp on video row updates           │
│    • Triggered BEFORE UPDATE                                                   │
└─────────────────────────────────────────────────────────────────────────────────┘

